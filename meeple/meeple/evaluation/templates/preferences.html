{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block body %}

<div id="infoGame" class="modal information">
    <div class="d-flex justify-content-center align-items-center" style="height: 100vh;">
        <div class="position-relative info-content p-5 border-1 m-auto">
            <span class="close" onclick="closeInformation()">&times;</span>

            <div class="row">
                <div class="col-md-4">
                    <img id="infoImage" src="" class="img-fluid p-3" draggable="false">
                </div>
                <div class="col-md-8">
                    <h2 id="infoTitle"></h2>
                    <p id="infoKeys" style="word-wrap: break-word;"></p>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <p id="infoDescription"></p>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="myModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeNotification()">&times;</span>
        <h2>{% trans "PreferencesNotTitle" %}</h2>
        <p>{% trans "PreferencesNotInfo" %}</p>
    </div>
</div>

<div class="position-relative custom-container zindex-0">
    <div class="position-absolute top-50 start-50 translate-middle negative-padding-bottom zindex-0">
        <img src="{% static 'images/dicesNoback.png' %}" alt="Image" draggable="false"
            style="transform: rotate(31deg);">
    </div>

    <div class="shadow-lg p-5 bg-body rounded rounded-5 position-absolute top-50 start-50 translate-middle border border-dark border-2 w-75 h-100 mb-4"
        style="max-height: 80vh;">
        <h2 class="pb-4 fw-bold">{% trans "PreferencesTitle" %}
            <i class="bi bi-info-circle" onclick="openNotification()"></i>
            <!-- Icono de información con función de notificación -->
        </h2>
        <h5>{% trans "PreferencesInfo" %}</h5>
        <div class="scroll-hover-pref w-100" style="max-height: 50vh;">
            <form action="" method="post" class="d-flex flex-column justify-content-center align-items-center w-100">
                {% csrf_token %}

                <div class="row w-100 h-100">
                    {% for gameRow in zacatrus_games %}
                    <div class="col-xl-4">
                        <div class="rounded-div">
                            <img src="{{ MEDIA_URL }}images_zacatrus/{{ gameRow.0 }}.jpg" class="img-fluid rounded sm-maxwidth" draggable="false">
                            <!-- Show the names of the tablegames -->
                            <h4> {{ gameRow.1 }} <i class="bi bi-info-circle" onclick="openInformation('{{ gameRow.1 }}', '{{ gameRow.4 }}', '{{ gameRow.6 }}', '{{ gameRow.7 }}', '{{ gameRow.3 }}', '{{ MEDIA_URL }}images_zacatrus/{{ gameRow.0 }}.jpg')"></i></h4>
                            <input type="checkbox" class="changeColorCheckbox" name="likedPreferences" value={{ gameRow.0 }}>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <button type="submit" class="btn btn-primary rounded-pill btn-terracota w-50" id="submitButton" style="position: sticky; bottom: 5px;"
                    disabled>{% trans "PreferencesSubmitButton" %}</button>
            </form>
        </div>
    </div>

</div>

<script>
    // Uso de javascript en vez de :has() porque no podemos asegurar
    // el uso de navegadores modernos
    const checkboxes = document.querySelectorAll('.changeColorCheckbox');
    let minimumFour = 0;

    // Recorrer cada checkbox y agregarle un evento de escucha
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function () {
            // Obtener el contenedor padre del checkbox
            const container = this.closest('.rounded-div');

            // Verificar si el checkbox está marcado o desmarcado
            if (this.checked) {
                container.classList.add('checked');  // Añadir la clase 'checked' si está marcado
                minimumFour += 1;
            } else {
                container.classList.remove('checked');  // Remover la clase 'checked' si está desmarcado
                minimumFour -= 1;
            }

            // Deshabilitar o habilitar el botón de submit
            document.getElementById('submitButton').disabled = (minimumFour < 4);
        });
    });

    // Función para abrir el modal
    function openNotification() {
        document.getElementById("myModal").style.display = "block";
    }

    // Función para abrir la ventana de información del juego
    function openInformation(title, categories, types, contexts, description, imageUrl) {
        document.getElementById("infoGame").style.display = "block";
        
        document.getElementById("infoTitle").textContent = title;
        document.getElementById("infoKeys").textContent = categories + " " + types + " " + contexts;
        document.getElementById("infoDescription").textContent = description;
        document.getElementById("infoImage").src = imageUrl;
    }

    // Función para cerrar el modal
    function closeNotification() {
        document.getElementById("myModal").style.display = "none";
    }

    // Función para cerrar la ventana de información del juego
    function closeInformation() {
        document.getElementById("infoGame").style.display = "none";
    }

    // Cerrar el modal si se hace clic fuera de él
    window.onclick = function (event) {
        var modal = document.getElementById("myModal");
        var info = document.getElementById("infoGame");
        if (event.target == modal) {
            closeNotification();
        }
        if (event.target == info) {
            closeInformation();

        }
    }
</script>

{% endblock body %}