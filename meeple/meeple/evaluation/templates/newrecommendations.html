{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block overflow %}

<body style="overflow-x: hidden;">

    {% endblock overflow %}

    {% block body %}

    <form action="" method="post">
        {% csrf_token %}

        <div id="finish" class="modal">
            <div class="modal-content info-content">
                <h2>{% trans "CreatorPtOne" %} &hearts; </h2>
                <br>
                <div class="form-control form-rounded">
                    <h5>{% trans "CreatorPtTwo" %}</h5>
                    <br>
                    <div class="d-flex flex-column flex-md-row justify-content-between custom-width mx-auto">
                        <button type="submit" class="btn btn-primary rounded-pill btn-terracota px-4 mb-3"
                            value="moreEvals" name="button">{% trans "CreatorButtonPtOne" %}</button>
                        <button type="submit" class="btn btn-primary rounded-pill btn-mostaza px-4 mb-3" value="exit"
                            name="button">{% trans "CreatorButtonPtTwo" %}</button>
                    </div>

                </div>
            </div>
        </div>

        <div class="position-relative custom-container">
            <div class="position-absolute top-0 start-0">
                <img src="{% static 'images/dicesLeft.png' %}" alt="Image" draggable="false"
                    style="transform: rotate(64deg);">
            </div>

            <div class="position-absolute bottom-0 end-0">
                <img src="{% static 'images/dicesRight.png' %}" alt="Image" draggable="false"
                    style="transform: rotate(31deg);">
            </div>

            <div
                class="justify-content-start shadow-lg p-5 bg-body rounded rounded-5 position-absolute top-0 start-50 translate-middle-x border border-dark border-2 custom-width">

                <ul class="list-group list-group-flush">
                    <h2>{% trans "NewRecommendationTitle" %}</h2>
                    <h4>{% trans "PreferencesTitle" %}</h4>
                    <div style="width: 100%; text-align: center;">
                        {% for preference in preferences_part %}
                        <span
                            style="display: inline-block; background-color: #d3d3d3; border: 2px solid #a9a9a9; margin: 5px; padding: 5px;">
                            {{ preference }}
                        </span>
                        {% endfor %}
                    </div>
                    <hr>


                    {% for gameRow in zacatrus_games %}
                    <li class="list-group-item">
                        <div class="row w-100">
                            <div class="col-12 col-sm-3">
                                <img src="{{ MEDIA_URL }}images_zacatrus/{{ gameRow.0 }}.jpg" alt="Image"
                                    class="img-fluid">
                            </div>
                            <div class="col-12 col-sm-1"><br></div>
                            <div class="col-12 col-sm-8 ">
                                <div style="max-width: 100%; overflow-x: auto;">
                                    <div class="d-flex flex-wrap">
                                        <h4>{{ gameRow.1 }} <i class="bi bi-info-circle"
                                                onclick="openNotification()"></i></h4>
                                        <table>
                                            <tbody>
                                                <tr>
                                                    <td>
                                                        <p>{% trans "Q1 recomm" %}</p>

                                                    </td>
                                                    <td>
                                                        <div class="form-group">
                                                            <select class="form-control"
                                                                id="firstquestion-{{ gameRow.0 }}">
                                                                <option value="1">1</option>
                                                                <option value="2">2</option>
                                                                <option value="3">3</option>
                                                                <option value="4">4</option>
                                                                <option value="5">5</option>
                                                            </select>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <p>{% trans "Q2 recomm" %}</p>

                                                    </td>
                                                    <td>
                                                        <div class="form-group">
                                                            <select class="form-control"
                                                                id="secondquestion-{{ gameRow.0 }}">
                                                                <option value="1">1</option>
                                                                <option value="2">2</option>
                                                                <option value="3">3</option>
                                                                <option value="4">4</option>
                                                                <option value="5">5</option>
                                                            </select>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <p>{% trans "Q3 recomm" %}</p>

                                                    </td>
                                                    <td>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox"
                                                                id="thirdquestion-{{ gameRow.0 }}" name="boolean">
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <p>{% trans "Q4 recomm" %}</p>

                                                    </td>
                                                    <td>
                                                        <div class="form-group">
                                                            <textarea class="form-control"
                                                                id="fourthquestion-{{ gameRow.0 }}" rows="4"
                                                                placeholder="{% trans 'textfield' %}"></textarea>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <p>{% trans "Q5 recomm" %}</p>

                                                    </td>
                                                    <td>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox"
                                                                id="fifthquestion-{{ gameRow.0 }}" value="1">
                                                            <label class="form-check-label"
                                                                for="fifthquestion-{{ gameRow.0 }}">
                                                                {% trans "Q5 choice 1" %}
                                                            </label>
                                                        </div>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox"
                                                                id="fifthquestion-{{ gameRow.0 }}" value="2">
                                                            <label class="form-check-label"
                                                                for="fifthquestion-{{ gameRow.0 }}">
                                                                {% trans "Q5 choice 2" %}
                                                            </label>
                                                        </div>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox"
                                                                id="fifthquestion-{{ gameRow.0 }}" value="3">
                                                            <label class="form-check-label" for="3">
                                                                {% trans "Q5 choice 3" %}
                                                            </label>
                                                        </div>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox"
                                                                id="fifthquestion-{{ gameRow.0 }}" value="4">
                                                            <label class="form-check-label" for="4">
                                                                {% trans "Q5 choice 4" %}
                                                            </label>
                                                        </div>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox"
                                                                id="fifthquestion-{{ gameRow.0 }}" value="5">
                                                            <label class="form-check-label" for="5">
                                                                {% trans "Q5 choice 5" %}
                                                            </label>
                                                        </div>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox"
                                                                id="fifthquestion-{{ gameRow.0 }}" value="6">
                                                            <label class="form-check-label" for="6">
                                                                {% trans "Q5 choice 6" %}
                                                            </label>
                                                        </div>
                                                    </td>
                                                </tr>

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                    {% endfor %}
                </ul>

                <div class="d-flex justify-content-end">
                    <input type="hidden" id="selections" name="selections" value="">
                    <button type="button" class="btn btn-primary rounded-pill btn-terracota w-50 br-0" id="submitButton"
                        onclick="sendRecomOpenInfo()">{% trans "SendEval" %}</button>
                </div>
            </div>
    </form>
    </div>

    <script>
        // Función para abrir la ventana de agradecimiento
        function sendRecomOpenInfo() {
            saveAllResponses()
            document.getElementById("finish").style.display = "block";
        }

        // Función para cerrar la ventana de agradecimiento
        function closeInformation() {
            document.getElementById("finish").style.display = "none";
        }

        // Cerrar la ventana flotante si se hace clic fuera de él
        window.onclick = function (event) {
            var finish = document.getElementById("finish");
            if (event.target == finish) {
                closeInformation();
            }
        }

        function saveAllResponses() {
            // Selecciona todas las filas del tbody
            const rows = document.querySelectorAll('tbody tr');
            const selections = {};

            rows.forEach(row => {
                // Obtén todos los inputs/selects/checkboxes en la fila
                const inputs = row.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    // Obtén el nombre dinámico y su valor
                    const id_input = input.id;

                    // Extrae el ID del elemento (gameRow.0)
                    const idMatch = id_input.match(/-(.+)/);
                    if (idMatch) {
                        const id = idMatch[1];

                        // Si aún no existe el id, inicializa su entrada en el objeto
                        if (!selections[id]) {
                            selections[id] = {};
                        }

                        // Manejo especial para checkboxes
                        if (input.type === 'checkbox' && input.name != 'boolean') {
                            if (!selections[id][id_input.split('-')[0]]) {
                                selections[id][id_input.split('-')[0]] = [];
                            }
                            if (input.checked) {
                                selections[id][id_input.split('-')[0]].push(input.value);
                            }
                        } else {
                            // Para otros tipos de input (select, textarea, etc.)
                            selections[id][id_input.split('-')[0]] = input.type === 'checkbox' ? input.checked : input.value;
                        }
                    }
                });
            });

            // Muestra el JSON en consola para verificar
            // console.log('Respuestas guardadas:', JSON.stringify(responses));
            document.getElementById('selections').value = JSON.stringify(selections);
        }


    </script>


    {% endblock body %}